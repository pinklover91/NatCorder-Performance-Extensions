const NatCorder={$sharedInstance:[],NCCreateWEBMRecorder:function(e,t,a,r,n,o,c,i){const s=document.createElement("canvas");s.width=e,s.height=t;const d=s.getContext("2d"),f=d.getImageData(0,0,e,t),u=s.captureStream(a).getVideoTracks()[0];console.log("NatCorder: WEBMRecorder prepared video encoder at resolution",e,"x",t,"@",a,"Hz with average bitrate",r);const l=n>0&&o>0,h=l?new AudioContext({latencyHint:"interactive",sampleRate:n}):void 0,m=h&&h.createMediaStreamDestination({channelCount:o,channelCountMode:"explicit"}),C=m&&m.stream.getAudioTracks()[0],g=l?[u,C]:[u];l&&console.log("NatCorder: WEBMRecorder prepared audio encoder at for",o,"channels at",n,"Hz");const p={mimeType:sharedInstance.MIME_TYPE,videoBitsPerSecond:r},B=new MediaRecorder(new MediaStream(g),p);B.ondataavailable=function(e){const t=new Blob([e.data],{type:"video/webm"}),a=URL.createObjectURL(t);console.log("NatCorder: WEBMRecorder finishing",t,"at URL",a);const r=lengthBytesUTF8(a)+1,n=_malloc(r);stringToUTF8(a,n,r),Runtime.dynCall("vii",c,[i,n]),_free(n)},B.start();const b={recorder:B,frameBuffer:s,frameBufferContext:d,pixelBuffer:f,audioContext:h,audioStream:m};return sharedInstance.push(b)-1},NCFrameSize:function(e,t,a){const r=sharedInstance[e].pixelBuffer;new Int32Array(HEAPU8.buffer,t,1)[0]=r.width,new Int32Array(HEAPU8.buffer,a,1)[0]=r.height},NCCommitFrame:function(e,t,a){const r=sharedInstance[e],n=r.frameBufferContext,o=r.pixelBuffer;for(var c=4*o.width,i=0;i<o.height;i++){const e=new Uint8Array(HEAPU8.buffer,t+(o.height-i-1)*c,c);o.data.set(e,i*c)}n.putImageData(o,0,0)},NCCommitSamples:function(e,t,a,r){const n=sharedInstance[e],o=n.audioContext,c=n.audioStream,i=o.sampleRate,s=c.channelCount,d=o.createBuffer(s,a/s,i),f=new Float32Array(HEAPU8.buffer,t,a);for(var u=0;u<d.numberOfChannels;u++){const e=d.getChannelData(u);for(var l=0;l<d.length;l++)e[l]=f[l*d.numberOfChannels+u]}var h=o.createBufferSource();h.buffer=d,h.connect(c),h.start()},NCFinishWriting:function(e){const t=sharedInstance[e],a=t.recorder,r=t.audioContext;a.stop(),r&&r.close()}};autoAddDeps(NatCorder,"$sharedInstance"),mergeInto(LibraryManager.library,NatCorder);